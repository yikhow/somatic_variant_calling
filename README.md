# ğŸ§¬ Somatic Variant Calling Pipeline (GATK4 Best Practices)

## ğŸ“‹ Overview

This repository provides a containerized, automated pipeline for somatic variant calling from a single pair of tumor and normal high-throughput sequencing data. The workflow strictly adheres to the **GATK4 Best Practices** for Somatic Short Variant Discovery (Mutect2).

### ğŸ¯ Objective

To identify high-confidence somatic SNVs and Indels from raw FastQ files, perform functional annotation, and generate publication-quality genomic visualizations.

---

## âš™ï¸ Workflow Architecture

The pipeline automates the following stages within a controlled Docker environment:

1. **Preprocessing**: Adapter trimming and quality filtering via `fastp` âš¡
2. **Alignment**: Read mapping to the `hg38` reference genome using `BWA-MEM` ğŸ”
3. **GATK Post-processing**: Duplicate marking (`MarkDuplicates`) and Base Quality Score Recalibration (`BQSR`) ğŸ› ï¸
4. **Somatic Calling**: Variant discovery via `Mutect2` (Tumor-Normal mode) ğŸ§ª
5. **Refinement**: Contamination estimation, orientation bias filtering, and hard filtering (`FilterMutectCalls`) ğŸ§¹
6. **Annotation**: Functional effect prediction using GATK `Funcotator` ğŸ·ï¸
7. **Visualization**: Statistical summary and oncogenic plotting via R `maftools` ğŸ“Š

---

## ğŸ“‚ Project Structure

To maintain a lightweight repository, large genomic data (FastQ, BAM, VCF) are excluded from version control via `.gitignore`.

```text
.
â”œâ”€â”€ Dockerfile               # Image build instructions
â”œâ”€â”€ environment.yml          # Conda dependency definitions
â”œâ”€â”€ run_pipeline.sh          # Master orchestration script
â”œâ”€â”€ scr/                     # Modular processing scripts
â”œâ”€â”€ doc_images/              # Curated result plots for documentation ğŸ–¼ï¸
â””â”€â”€ .gitignore               # Prevents tracking of local data (reads/, results/)

```

---

## ğŸ› ï¸ Installation & Usage

### 1. Clone and Build

Build the image from the project root:

```bash
git clone https://github.com/yourusername/somatic_variant_calling.git
cd somatic_variant_calling
sudo docker build -t somatic-pipeline:v1 .

```

### 2. Data Preparation ğŸ“¦

The pipeline is designed to be self-sufficient regarding genomic resources.

* **Reads**: Provide raw data in the `reads/` directory:
* `SRR7890918_1/2.fastq.gz` (Normal/Blood)
* `SRR7890919_1/2.fastq.gz` (Tumor/Breast Cancer)


* **Resources**: The script includes **automated download logic** for the `hg38` Reference FASTA, BWA index, GnomAD, and PON files. These will be stored in `resources/` upon the first execution.

### 3. Execution ğŸš€

Run the container by mounting your local workspace to the internal `/pipeline` path:

```bash
sudo docker run --rm \
  -v "$(pwd)/reads:/pipeline/reads" \
  -v "$(pwd)/resources:/pipeline/resources" \
  -v "$(pwd)/results:/pipeline/results" \
  -v "$(pwd)/plots:/pipeline/plots" \
  -v "$(pwd)/aligned_reads:/pipeline/aligned_reads" \
  somatic-pipeline:v1

```

---

## ğŸ§ª Demo & Validation

The demonstration utilizes **subsetted FastQ reads** from **SRR7890918** (Normal) and **SRR7890919** (**Breast Cancer** tumor) to ensure rapid workflow validation.

### âœ¨ Expected Results

The pipeline successfully captures the mutational landscape of the Breast Cancer sample:

* **Ti/Tv Ratio**: Validates the transition/transversion ratio typical of the expected mutational signature for this cancer type.
* **Driver Mutations**: Successfully identified a high-impact somatic variant in **KMT2C**, a gene frequently associated with genomic instability and chromatin remodeling in Breast Cancer.

### ğŸ–¼ï¸ Visualization Samples

The following outputs are automatically generated by the visualization module:

| Mutation Summary | Ti/Tv Distribution | Lollipop Plot (KMT2C) |
| :---: | :---: | :---: |
| ![Summary](doc_images/maf_summary.png) | ![Ti/Tv](doc_images/titv_distribution.png) | ![Lollipop](doc_images/lollipop_KMT2C.png) |
| *Overall variant statistics* | *Substitution patterns* | *KMT2C mutation site* |

---

## âš ï¸ Technical Limitations

* **Single-Pair Only**: Optimized for 1-Tumor vs. 1-Normal analysis; does not support multi-sample cohort processing.
* **Absolute Paths**: Volume mounting requires absolute host paths as per Docker specifications.

---

